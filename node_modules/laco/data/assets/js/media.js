Dropzone.autoDiscover = false;
var LacoMedia = function() {
    var self = {};
    self.selectors = ['.laco-upload-holder'];
    var lacoDropzone = $(self.selectors.join(',')).dropzone({
        previewTemplate: $('#laco-dz-preview-tpl').html(),
        thumbnailWidth: 300,
        thumbnailHeight: 300,
        parallelUploads: 1,
        autoQueue: true,
        //acceptedFiles: "image/*,video/*,application/*,text/*,application/octet-stream",
        paramName: "lacoFile",
        accept: function(file, done) {
            var thumbnail = $('.thumb', file.previewElement);
            var fileMimeType = file.type;
            var fileMimeTypes = fileMimeType.split('/');
            if(fileMimeTypes[0] != 'image') {
                var fps = file.name.split('.');
                var fileExt = fps.length > 1 ? file.name.split('.').pop() : '...';
                thumbnail.replaceWith(`<div class="thumb not-image thumb-file-${fileExt}"><span>${fileExt}</span></div>`)
            }
            done();
        },
        success: function(file, res) {
            if(typeof res == 'string' || !res.status) {
                var serverMessage = (typeof res == 'string') ? res : res.message;
                serverMessage = $('<div>' + serverMessage + '</div>').text().replace(/\n/g, ' ');
                $(file.previewElement).addClass('dz-error');
                $('.dz-message.message span', file.previewElement).html(serverMessage);
            }
            else {
                $(file.previewElement).addClass('dz-success');
                $('.dz-message.message span', file.previewElement).html(res.message);
            }
        },
        error: function(file, m) {
            var serverMessage = $('<div>' + m + '</div>').text().replace(/\n/g, ' ');
            $(file.previewElement).addClass('dz-error');
            $('.dz-message.message span', file.previewElement).html(serverMessage);
        },
        headers: {
            'x-csrf-token': $('meta[name="_csrf"]').attr('content')
        },
        url: lacoUploadPath
    });
    return lacoDropzone;
};
var lacoDropzone = new LacoMedia();