var LacoModal = function(element) {
    this.element = element;
    this.init();
    this.listener();
}

LacoModal.totalModals = 0;
LacoModal.randomId = function() {
    var x = 10000000000;
    var rand = Math.floor(Math.random()*x) + 1;
    return `${new Date().getTime()}-${rand}`;
}

LacoModal.prototype.init = function(element) {
    this.modalId = LacoModal.randomId();
}

LacoModal.prototype.listener = function() {
    var self = this;
    this.element.on('click', function(e) {
        e.preventDefault();
        LacoModal.totalModals++;
        self.template();
    });
}

LacoModal.prototype.template = function() {
    var self = this;
    var modalTpl = `
        <div class="laco-modal-holder" id="laco-modal-${this.modalId}">
            <div class="laco-modal">
                <div class="laco-modal-content">
                    <div class="laco-modal-frame">
                        <div class="laco-modal-header"><h1>Insert Media<span class="dashicons dashicons-arrow-down"></span></h1></div>
                        <div class="laco-modal-content">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="laco-modal-overlay" id="laco-modal-overlay-${this.modalId}"></div>`;
    
    $('body').addClass('laco-modal-activated');
    $('body').append(modalTpl);
    setTimeout(function() {
        $('.laco-modal').addClass('active');
    }, 100);
    this.modal = $(`#laco-modal-${this.modalId}`);
    this.overlay = $(`#laco-modal-overlay-${this.modalId}`);

    this.overlay.on('click', function(e) {        
        e.preventDefault();
        LacoModal.totalModals--;
        $('.laco-modal', this.modal).removeClass('active');
        $('.laco-modal-overlay', this.modal).animate({opacity: 0}, 100, function() {
            self.overlay.remove();
            self.modal.remove();
            if(LacoModal.totalModals == 0) $('body').removeClass('laco-modal-activated');
        });
    });
}