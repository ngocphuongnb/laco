"use strict";

var path = require('path');
var _ = require('underscore');
var helper = require(path.join(LIBS_DIR, 'helper'));
var taxUtils = require(path.join(LIBS_DIR, 'taxonomy/tax_utils'));
module.exports = function(name, data) {
    var fieldId = name.replace('[', '_');
    fieldId = fieldId.replace(']', '_');
    var taxes = helper.treeBuilder(taxUtils.get(), '_id', 'parent');
    var fe = '\
    <div class="input-field nb-select-field col s12 m' + data.cols + '">\
        <select id="' + fieldId + '" name="' + name + '">';
            if(typeof data.required == 'undefined' || data.required == false) {
                var placeholder = _.isEmpty(taxes) ? lang('Nothing to select') : lang('Select');
                fe += '<option value="">' + placeholder + '</option>';
            }
            _.mapObject(taxes, function(tax) {
                if(!_.isString(data.ref_type) || (_.isString(data.ref_type) && (data.ref_type == '' || data.ref_type == tax.type))) {
                    var selected = (tax._id.toString() == data.value) ? ' selected' : '';
                    fe += '<option value="' + tax._id + '"' + selected + '>' + tax.prefix + tax.name + '</option>';
                }
            });
        fe += '\
        </select>\
        <label for="' + fieldId + '" class="">' + data.label + '</label>\
    </div>';
    return fe;
};



