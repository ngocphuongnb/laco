'use strict';

const path = require('path');
const express = require('express');
const _ = require('lodash');
const Router = require('../router');
const Controller = require('../controller');
const logger = require('../logger');
const helper = require('../helper');

class SubAppBase {
    constructor(name = '', options = {}) {
        this.caller = helper.caller();
        this.name = name || this.caller.baseDir.trimChar('/').replace('node_modules/laco-ext-', 'ext::');
        this.options = _.merge({
            mvc: {
                enabled: true,
                controllerPath: path.join(this.caller.dir, 'controllers')
            }
        }, options);
        this.express = express();
        this.router = new Router(this.name, this.express);
        this.controller = new Controller(this.name, this.express);
    }

    dispatch() {
        this.router.dispatch();
    }
}

module.exports = SubAppBase;