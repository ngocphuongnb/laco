"use strict";

const path = require('path');
const _ = require('underscore');
const logger = lacoLib('./libs/logger');
const imagemin= require('imagemin');
const imageminOptipng = require('imagemin-optipng');
const imageminGifsicle = require('imagemin-gifsicle');
const imageminJpegtran = require('imagemin-jpegtran');
const imageminPngquant = require('imagemin-pngquant');
const imageminSvgo = require('imagemin-svgo');

const compressImage = imageFiles => {
    if(!_.isArray(imageFiles)) imageFiles = [imageFiles];
    imagemin(imageFiles, path.dirname(imageFiles[0]), {
        plugins: [
            imageminOptipng(),
            imageminGifsicle(),
            imageminJpegtran(),
            imageminPngquant(),
            imageminSvgo()
        ]
    })
    .then(files => logger.info('Image compression completed'))
    .catch(err => {
        logger.error(`[Lib.media.omtimizer.compressImage] Error while compressing image file: `);
        logger.error(imageFile);
        logger.error(err);
    });
}

exports.compressImage = compressImage;