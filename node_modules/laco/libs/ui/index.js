'use strict';

const _ = require('lodash');
const logger = require('../logger');
const helper = require('../helper');

const UITask = require('./task');
const UIBase = require('./base');
const UILayout = require('./layout');
const UIView = require('./view');
const UICommand = require('./command');

class UIManager {
    constructor(laco) {
        this.laco = laco;
        this.registerdUIs = {};

        this.BasedUI = {
            name: null,
            label: null,
            default: false,
            handler: null,
        }

        this.defaultUI = null;
        let uiCommand = new UICommand(this);
        uiCommand.option([{
                name: 'list',
                description: 'List all available tasks',
                require: false,
            },
            {
                name: 'run',
                description: 'Run an UI tasks',
                require: true,
            }
        ]);

        this.laco.CMD.register(uiCommand);
    }

    register(uis) {
        if (!_.isArray(uis)) {
            uis = [uis];
        }

        for (var i = 0; i < uis.length; i++) {
            let ui = _.merge(_.clone(this.BasedUI), uis[i]);

            if (!ui.name) {
                logger.error(`[UIMana.register] Invalid UI: `, ui);
            } else {
                logger.info(`[UIMana.register] Registering ui: ${ui.name}`);
                this.registerdUIs[ui.name] = new ui.handler(this, ui);
                this.registerdUIs[ui.name].caller = helper.caller();
                if (ui.default) {
                    this.defaultUI = ui;
                }
            }
        }
    }
}

exports.Manager = UIManager;
exports.Task = UITask;
exports.Base = UIBase;
exports.Layout = UILayout;
exports.View = UIView;