"use strict";
const eventEmitter = lacoLib('./libs/eventEmitter');
const router = lacoLib('./libs/router');
const logger = lacoLib('./libs/logger');
const adminRouter = require('./admin');
const Extension = lacoLib('./libs/extension');

let handleHomeGet = (req, res) => {
    res.send(res.abc + ' home handler outside');
}

class ExtRouter extends Extension {
    constructor() {
        super(__dirname, 'Router ext');
        super.registerViews([
            'login',
            'register'
        ]);
    }
    login(req, res) {
        this.render('login', {}, req, res);
    }
}

eventEmitter.on('laco.exts.loaded', laco => {
    let extRouter = new ExtRouter();
    adminRouter.init(laco);
    laco.app.use('/' + laco.nconf.get('APP_ADMIN_DIR'), adminRouter.middleware());

    router.register({
        name: 'home',
        label: 'Home page',
        priority: 2,
        path: '/',
        get: handleHomeGet,
    });
    router.register({
        name: 'login',
        label: 'Login',
        priority: 3,
        path: '/login',
        get: extRouter.login
    });
});