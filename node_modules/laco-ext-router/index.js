"use strict";
const nconf = require('nconf');
const eventEmitter = lacoLib('./libs/eventEmitter');
const router = lacoLib('./libs/router');
const logger = lacoLib('./libs/logger');
const adminRouter = require('./admin');

let handleHomeGet = (req, res) => {
    res.send(res.abc + ' home handler outside');
}

eventEmitter.on('app.exts.loaded', app => {
    app.use('/' + nconf.getet('APP_ADMIN_DIR'), adminRouter);

    app.use((req, res, next) => {
        res.end('Terminated from app use');
    })

    router.register({
        name: 'home',
        label: 'Home page',
        priority: 2,
        path: '/',
        get: handleHomeGet,
    });
    router.register({
        name: 'category',
        label: 'Category page',
        priority: 2,
        path: '/:caturl',
        get: (req, res) => {
            logger.console(req.route);
            res.end('Category page ahihi')
        }
    });
    router.middleware({
        route: 'home',
        get: (req, res, next) => {
            res.abc = 'cde';
            next();
        }
    });
    router.attach('home', 'post', handleHomeGet);
});