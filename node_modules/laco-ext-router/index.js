"use strict";
const eventEmitter = lacoLib('./libs/eventEmitter');
const router = lacoLib('./libs/router');
const logger = lacoLib('./libs/logger');
const adminRouter = require('./admin');
const Extension = lacoLib('./libs/extension');
const loadedExts = lacoLib('./libs/ext_loader').loadedExts;

let handleHomeGet = (req, res) => {
    res.send(res.abc + ' home handler outside');
}

class ExtRouter extends Extension {
    constructor(laco) {
        super(__dirname, 'Router ext');
        super.registerViews([
            'login',
            'register'
        ]);

        adminRouter.init(laco);
        laco.app.use('/' + laco.nconf.get('APP_ADMIN_DIR'), adminRouter.middleware());

        router.register({
            name: 'home',
            label: 'Home page',
            priority: 2,
            path: '/',
            get: handleHomeGet,
        });
        router.register({
            name: 'login',
            label: 'Login',
            priority: 3,
            path: '/login',
            get: (req, res, next) => loadedExts.router.login(req, res, next)
        });
        router.register({
            name: 'login2',
            label: 'Login 2',
            priority: 3,
            path: '/login2',
            get: (req, res, next) => {
                this.view('login', {}, req, res);
            }
        });
    }
    
    login(req, res) {
        this.view('login', {}, req, res);
    }
}

module.exports = ExtRouter;