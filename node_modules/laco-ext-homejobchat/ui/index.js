'use strict';

const path = require('path');
const logger = lacoLib('libs/logger');
const UIBase = lacoLib('libs/ui/base');

class HomeJobAssetUI extends UIBase {
    constructor(manager, ui) {
        super(manager, ui, {});

        this.addTasks([{
                name: 'prepare',
                description: 'Create UI output dir',
                cmd: 'mkdir',
                target: ['/js', '/css', '/images'],
            },
            {
                name: 'clean',
                description: 'Clear old output files',
                cmd: 'rm',
                target: ['/js/*', '/css/*', '/images/*'],
            },
            {
                name: 'ChatFunctions',
                description: 'Build Chat functions',
                cmd: (cmd, task, callback) => {
                    let gulp = cmd.gulp;

                    gulp.task('ChatFunctions', () => {
                        logger.info('  [ext.admin.ui.HomeJobAssetUI] Running ChatFunctions...');
                        return gulp.src([
                                path.join(this.extDir, 'assets/js/requirement_check.js'),
                                path.join(this.extDir, 'assets/js/functions.js'),
                            ])
                            .pipe(cmd.gulpStripDebug())
                            .pipe(cmd.gulpUglify())
                            .pipe(cmd.gulpConcat('chat.min.js'))
                            .pipe(gulp.dest('/js'))
                    });

                    gulp.task('alltasks', ['ChatFunctions']).on('end', cb => callback());
                    gulp.start.apply(gulp, ['alltasks']);
                }
            }
        ]);

        this.laco.emit('ui.HomeJobAssetUI.loaded');
    }
}

module.exports = HomeJobAssetUI;