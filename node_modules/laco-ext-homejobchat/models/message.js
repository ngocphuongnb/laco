'use strict';

const mongoose = require('mongoose');
const autoIncrement = require('mongoose-auto-increment');
const helper = lacoLib('libs/helper');
const db = require('./db');

db.schemas.message = new mongoose.Schema({
    conversationid: {
        type: Number,
        required: [true, 'Conversation ID is required'],
    },
    userid: {
        type: Number,
        required: [true, 'UserID is required'],
    },
    content: {
        type: String,
        required: [true, 'Message is required'],
    },
    created_date: {
        type: Date,
        default: Date.now
    },
    updated_date: {
        type: Date,
        default: Date.now
    },
});

db.schemas.message.index({
    userid: 1,
    conversation_id: 1
}, {
    weights: {
        userid: 10,
        conversation_id: 8
    },
    name: 'messageIndex'
});

db.schemas.message.plugin(autoIncrement.plugin, {
    model: 'messages',
    field: 'intId',
    startAt: 1,
    incrementBy: 1
});

db.models.message = mongoose.model('messages', db.schemas.message);