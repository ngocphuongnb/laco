if(void 0===window.HJChat){function HJLogger(i){this.name="HJLogger","object"==typeof i&&Object.assign(this,i)}function HJChat(i){if("undefined"==typeof jQuery&&this.logger("jQuery is required for HJChat to run..."),"undefined"==typeof io&&this.logger("SocketIO is required for HJChat to run..."),void 0!==i&&"object"!=typeof i)return this.logger.error("Invalid options:",i);this.options=Object.assign(this.options,i)}HJLogger.prototype.info=function(i,t){},HJLogger.prototype.warn=function(i,t){},HJLogger.prototype.error=function(i,t){throw new Error("["+this.name+" "+i+" "+JSON.stringify(t))},HJChat.logger=new HJLogger({name:"HJChatLogger"}),HJChat.prototype.logger=new HJLogger({name:"HJChat"}),HJChat.prototype.options={"socket.host":window.location.origin,"socket.path":"/socket","socket.resource":"/socket","ui.discussion.trigger":".discussion-item","ui.discussion.user_info":function(i,t){},"ui.discussion.load_msg":function(i,t){},"ui.discussion.wrapper":".hjchat-msg-wrapper","ui.discussion.template":".hjchat-msg-template","ui.discussion.item_class":"hjchat-discussion-item","ui.discussion.id_prefix":"hj-discussion-","ui.form":"form.hjchat-form","ui.form.input":".hjchat-input","ui.msg.list":".hjchat-msgs","ui.msg.template":"<li>@msg</li>"},HJChat.prototype.config=function(i){if("object"!=typeof i)return this.logger.error("[Config] Invalid options:",i);this.options=Object.assign(this.options,i)},HJChat.prototype.socket=null,HJChat.prototype.events={},HJChat.prototype.loadedDiscussions={},HJChat.prototype.isLoadedDiscussion=function(i){return!!this.loadedDiscussions[i]},HJChat.prototype.init=function(){var i=this;$(this.options["ui.discussion.template"]).length&&$(this.options["ui.discussion.template"]).hide(),this.socket=io(this.options["socket.host"],{path:this.options["socket.path"],resource:this.options["socket.resource"]}),this.socket.on("connect",function(){i.listen()})},HJChat.prototype.listen=function(){var e=this,i=window.location.hash;i&&(i=i.replace("#",""),this.openDiscussion(i)),$(document).on("click",this.options["ui.discussion.trigger"],function(i){var t=$(this).data("identity")||$(this).attr("id").replace("hjdicussionitem-","");i.preventDefault(),e.openDiscussion(t)}),$(document).on("submit",this.options["ui.form"],function(i){i.preventDefault();var t=$(e.options["ui.form.input"],$(this)),o=t.val(),s=$(this).data("identity");return s?(o&&e.socket.emit(e.events.CREATE_CHAT_MSG,{identity:s,msg:o}),t.val(""),!1):e.logger.error("Invalid chat identity")}),e.socket.on(e.events.NEW_CHAT_MSG,function(i){var t=i.msg,o=i.identity;"string"==typeof e.options["ui.msg.template"]&&(t=e.options["ui.msg.template"].replace(/@msg/g,t)),"function"==typeof e.options["ui.msg.template"]&&(t=e.options["ui.msg.template"](t)),$("#"+e.options["ui.discussion.id_prefix"]+o+" "+e.options["ui.msg.list"]).append(t)})},HJChat.prototype.openDiscussion=function(i){$(this.options["ui.form"]).data("identity",i);var t=window.location.hash;if(t&&(t=t.replace("#","")),t!=i&&(window.location.hash=i),!this.isLoadedDiscussion(i)){this.socket.emit("identity",i);var o=$(this.options["ui.discussion.template"]).clone();o.attr("id",this.options["ui.discussion.id_prefix"]+i),o.addClass(this.options["ui.discussion.item_class"]),o.removeClass(this.options["ui.discussion.template"].replace(/[\.#]/g,"")),$(this.options["ui.discussion.wrapper"]).append(o),this.options["ui.discussion.user_info"](i,o),this.options["ui.discussion.load_msg"](i,o),this.loadedDiscussions[i]=!0}$("."+this.options["ui.discussion.item_class"]).hide(),$("#"+this.options["ui.discussion.id_prefix"]+i).show()}}
"use strict";var HJChatEvents={CREATE_CHAT_MSG:"create_chat_msg",NEW_CHAT_MSG:"new_chat_msg"};"undefined"!=typeof window&&"undefined"!=HJChat&&(HJChat.prototype.events=Object.assign(HJChat.prototype.events,HJChatEvents)),"object"==typeof exports&&(exports.ChatEvents=HJChatEvents);
$(function(){(new HJChat).init()});